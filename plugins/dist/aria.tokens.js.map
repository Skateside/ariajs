{"version":3,"names":[],"mappings":"","sources":["aria.tokens.js"],"sourcesContent":["/**\r\n * @file    Adds a white-list of tokens for attributes and validation for the\r\n *          values being set.\r\n * @author  James \"Skateside\" Long\r\n * @license MIT\r\n */\r\n(function (ARIA) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * A simple wrapper for Array#slice.\r\n     *\r\n     * @private\r\n     * @param   {Array|Object} arrayLike\r\n     *          Array or array-like structure to slice.\r\n     * @param   {Number} [offset]\r\n     *          Optional offset for the slice.\r\n     * @return  {Array}\r\n     *          Sliced array.\r\n     */\r\n    var slice = function (arrayLike, offset) {\r\n        return Array.prototype.slice.call(arrayLike, offset);\r\n    };\r\n\r\n    /**\r\n     * A simple fall-back for Object.assign.\r\n     *\r\n     * @private\r\n     * @param   {Object} source\r\n     *          Source object to modify.\r\n     * @param   {Object} [...objects]\r\n     *          Additional objects to extend the first.\r\n     * @return  {Object}\r\n     *          Extended object.\r\n     */\r\n    var objectAssign = Object.assign || function (source) {\r\n\r\n        slice(arguments, 1).forEach(function (object) {\r\n\r\n            if (object) {\r\n\r\n                Object.keys(object).forEach(function (key) {\r\n                    source[key] = object[key];\r\n                });\r\n\r\n            }\r\n\r\n        });\r\n\r\n        return source;\r\n\r\n    };\r\n\r\n    /**\r\n     * A basic fallback for the isNaN function.\r\n     *\r\n     * @private\r\n     * @function\r\n     * @param    {?} value\r\n     *           Value to test.\r\n     * @return   {Boolean}\r\n     *           true if the value is NaN, false otherwise.\r\n     */\r\n    var isNotANumber = Number.isNaN || globalVariable.isNaN;\r\n\r\n    var BOOLEAN_TOKENS = [\r\n        \"true\",\r\n        \"false\"\r\n    ];\r\n\r\n    var triggerBackup;\r\n\r\n    if (ARIA && ARIA.VERSION) {\r\n\r\n        /**\r\n         * A warning message for invalid tokens.\r\n         * @type {String}\r\n         */\r\n        ARIA.WARNING_INVALID_TOKEN = (\r\n            \"'{0}' is not a valid token for the '{1}' attribute\"\r\n        );\r\n\r\n        /**\r\n         * A flag to enable warnings.\r\n         * @type {Boolean}\r\n         */\r\n        ARIA.enableWarnings = true;\r\n\r\n        /**\r\n         * Collection of all valid tokens for any given attribute. The attribute\r\n         * key should be the normalised value - see {@link ARIA.normalise}.\r\n         * @type {Object}\r\n         */\r\n        ARIA.tokens = objectAssign(Object.create(null), {\r\n            \"aria-autocomplete\": [\r\n                \"none\",\r\n                \"inline\",\r\n                \"list\",\r\n                \"both\"\r\n            ],\r\n            \"aria-current\": [\r\n                \"false\",\r\n                \"true\",\r\n                \"page\",\r\n                \"step\",\r\n                \"location\",\r\n                \"date\",\r\n                \"time\"\r\n            ],\r\n            \"aria-dropeffect\": [\r\n                \"none\",\r\n                \"copy\",\r\n                \"execute\",\r\n                \"link\",\r\n                \"move\",\r\n                \"popup\"\r\n            ],\r\n            \"aria-haspopup\": [\r\n                \"false\",\r\n                \"true\",\r\n                \"menu\",\r\n                \"listbox\",\r\n                \"tree\",\r\n                \"grid\",\r\n                \"dialog\"\r\n            ],\r\n            \"aria-invalid\": [\r\n                \"false\",\r\n                \"true\",\r\n                \"grammar\",\r\n                \"spelling\"\r\n            ],\r\n            \"aria-live\": [\r\n                \"off\",\r\n                \"assertive\",\r\n                \"polite\"\r\n            ],\r\n            \"aria-orientation\": [\r\n                undefined,\r\n                \"undefined\",\r\n                \"horizontal\",\r\n                \"vertical\"\r\n            ],\r\n            \"aria-relevant\": [\r\n                \"additions\",\r\n                \"all\",\r\n                \"removals\",\r\n                \"text\"\r\n            ],\r\n            \"aria-sort\": [\r\n                \"none\",\r\n                \"ascending\",\r\n                \"descending\",\r\n                \"other\"\r\n            ],\r\n            // \"Authors MUST NOT use abstract roles in content.\"\r\n            // https://www.w3.org/TR/wai-aria-1.1/#abstract_roles\r\n            \"role\": [\r\n                \"alert\",\r\n                \"alertdialog\",\r\n                \"application\",\r\n                \"article\",\r\n                \"banner\",\r\n                \"button\",\r\n                \"cell\",\r\n                \"checkbox\",\r\n                \"columnheader\",\r\n                \"complementary\",\r\n                \"combobox\",\r\n                // \"command\", // (abstract)\r\n                // \"composite\", // (abstract)\r\n                \"contentinfo\",\r\n                \"definition\",\r\n                \"dialog\",\r\n                \"directory\",\r\n                \"document\",\r\n                \"feed\",\r\n                \"figure\",\r\n                \"form\",\r\n                \"grid\",\r\n                \"gridcell\",\r\n                \"group\",\r\n                \"heading\",\r\n                \"img\",\r\n                // \"input\", // (abstract)\r\n                // \"landmark\", // (abstract)\r\n                \"link\",\r\n                \"list\",\r\n                \"listbox\",\r\n                \"listitem\",\r\n                \"log\",\r\n                \"main\",\r\n                \"marquee\",\r\n                \"math\",\r\n                \"menu\",\r\n                \"menubar\",\r\n                \"menuitem\",\r\n                \"menuitemcheckbox\",\r\n                \"menuitemradio\",\r\n                \"navigation\",\r\n                \"none\",\r\n                \"note\",\r\n                \"option\",\r\n                \"presentation\",\r\n                \"progressbar\",\r\n                \"radio\",\r\n                \"radiogroup\",\r\n                // \"range\", // (abstract)\r\n                \"region\",\r\n                // \"roletype\", // (abstract)\r\n                \"row\",\r\n                \"rowgroup\",\r\n                \"rowheader\",\r\n                \"scrollbar\",\r\n                \"search\",\r\n                \"searchbox\",\r\n                // \"section\", // (abstract)\r\n                // \"sectionhead\", // (abstract)\r\n                // \"select\", // (abstract)\r\n                \"separator\",\r\n                \"slider\",\r\n                \"spinbutton\",\r\n                \"status\",\r\n                // \"structure\", // (abstract)\r\n                \"switch\",\r\n                \"tab\",\r\n                \"table\",\r\n                \"tablist\",\r\n                \"tabpanel\",\r\n                \"term\",\r\n                \"textbox\",\r\n                \"timer\",\r\n                \"toolbar\",\r\n                \"tooltip\",\r\n                \"tree\",\r\n                \"treegrid\",\r\n                \"treeitem\"\r\n                // \"widget\", // (abstract)\r\n                // \"window\", // (abstract)\r\n            ]\r\n        });\r\n\r\n        /**\r\n         * Replaces the placeholders in the string parameter with information\r\n         * from the info parameter. Placeholders are wrapped in brackets\r\n         * e.g. \"{0}\".\r\n         *\r\n         * @param  {String} string\r\n         *         String containing placeholders.\r\n         * @param  {Array|Object} info\r\n         *         Info to fill the string placeholders.\r\n         * @return {String}\r\n         *         Populated string.\r\n         */\r\n        ARIA.supplant = function (string, info) {\r\n\r\n            return string.replace(/\\{(\\d+)\\}/g, function (whole, index) {\r\n\r\n                var arg = info[index];\r\n\r\n                return (\r\n                    (typeof arg === \"string\" || typeof arg === \"number\")\r\n                    ? arg\r\n                    : whole\r\n                );\r\n\r\n            });\r\n\r\n        };\r\n\r\n        /**\r\n         * Sends a warning if {@link ARIA.enableWarnings} is set to true. The\r\n         * message passed will be prefixes with \"aria.js: \".\r\n         *\r\n         * @param {String} message\r\n         *        The warning message.\r\n         */\r\n        ARIA.warn = function (message) {\r\n\r\n            if (ARIA.enableWarnings) {\r\n                console.warn(\"aria.js: \" + message);\r\n            }\r\n\r\n        };\r\n\r\n        /**\r\n         * Creates a factory that creates an aria property.\r\n         *\r\n         * @param  {String} attribute\r\n         *         Normalised name of the attribute whose factory is created.\r\n         * @param  {Function} Constructor\r\n         *         Constructor for {@link ARIA.Property} (or sub-class) that\r\n         *         will create the property.\r\n         * @return {Function}\r\n         *         A factory function that takes the element and returns the\r\n         *         instance.\r\n         */\r\n        ARIA.makeFactory = function (attribute, Constructor) {\r\n\r\n            return function (element) {\r\n\r\n                var tokens = ARIA.tokens[attribute];\r\n\r\n                if (!tokens) {\r\n\r\n                    tokens = [];\r\n                    ARIA.tokens[attribute] = tokens;\r\n\r\n                }\r\n\r\n                return new Constructor(element, attribute, tokens);\r\n\r\n            };\r\n\r\n        };\r\n\r\n        triggerBackup = ARIA.Property.prototype.trigger;\r\n\r\n        ARIA.Property.addMethods(/** @lends ARIA.Property.prototype */{\r\n\r\n            /**\r\n             * @constructs ARIA.Property\r\n             * @param      {Element} element\r\n             *             Element whose attribute should be handled.\r\n             * @param      {String} attribute\r\n             *             Name of the attribute to handle.\r\n             * @param      {Array.<String>} [tokens]\r\n             *             Optional white-list of valid tokens for this\r\n             *             property.\r\n             */\r\n            init: function (element, attribute, tokens) {\r\n\r\n                /**\r\n                 * Element whose attribute is being handled.\r\n                 * @type {Element}\r\n                 */\r\n                this.element = element;\r\n\r\n                /**\r\n                 * Attribute being handled.\r\n                 * @type {String}\r\n                 */\r\n                this.attribute = attribute;\r\n\r\n                /**\r\n                 * White-list of valid tokens. This is a reference to a property\r\n                 * of {@link ARIA.tokens} so updating that property will update\r\n                 * all these instances.\r\n                 * @type {Array.<String>}\r\n                 */\r\n                this.tokens = (\r\n                    (tokens && Array.isArray(tokens))\r\n                    ? tokens\r\n                    : []\r\n                );\r\n\r\n                // Things like ARIA.List work with interpretted values rather\r\n                // than just the attribute value. If the attribute already\r\n                // exists, pass the value to the set method to allow for that.\r\n                // As a bonus, this can filter out invalid attribute values.\r\n                if (ARIA.hasAttribute(element, attribute)) {\r\n                    this.set(ARIA.getAttribute(element, attribute));\r\n                }\r\n\r\n            },\r\n\r\n            /**\r\n             * Checks to see if the given token is valid for this current\r\n             * property. This function checks against\r\n             * {@link ARIA.Property#tokens}. If the token is not valid, a\r\n             * warning it sent. See {@link ARIA.warn}.\r\n             *\r\n             * @param  {String} token\r\n             *         Token to check.\r\n             * @return {Boolean}\r\n             *         true if the token is valid, false otherwise.\r\n             */\r\n            isValidToken: function (token) {\r\n\r\n                var tokens = this.tokens;\r\n                var isValid = (\r\n                    !tokens\r\n                    || !tokens.length\r\n                    || tokens.indexOf(token) > -1\r\n                );\r\n\r\n                if (!isValid) {\r\n\r\n                    ARIA.warn(\r\n                        ARIA.supplant(ARIA.WARNING_INVALID_TOKEN, [\r\n                            token,\r\n                            this.attribute\r\n                        ])\r\n                    );\r\n\r\n                }\r\n\r\n                return isValid;\r\n\r\n            },\r\n\r\n            // Documentation is unchanged, but we pass a new method to the\r\n            // detail. No JSDoc way of saying that, as far as I know.\r\n            trigger: function (event, detail) {\r\n\r\n                return triggerBackup.call(this, event, objectAssign({\r\n                    isValidToken: this.isValidToken.bind(this)\r\n                }, detail));\r\n\r\n            }\r\n\r\n        });\r\n\r\n        ARIA.List.addMethods(/** @lends ARIA.List.prototype */{\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            init: function (element, attribute, tokens) {\r\n\r\n                /**\r\n                 * The list of values.\r\n                 * @type {Array.<String>}\r\n                 */\r\n                this.list = [];\r\n\r\n                this.$super(element, attribute, tokens);\r\n\r\n            },\r\n\r\n            /**\r\n             * Checks the given tokens to make sure they're all valid.\r\n             *\r\n             * @param  {Array.<String>} tokens\r\n             *         Tokens to validate.\r\n             * @return {Boolean}\r\n             *         true if all tokens are valid, false otherwise.\r\n             */\r\n            areValidTokens: function (tokens) {\r\n\r\n                return tokens.every(function (token) {\r\n                    return this.isValidToken(token);\r\n                }, this);\r\n\r\n            },\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            trigger: function (event, detail) {\r\n\r\n                return this.$super(event, objectAssign({\r\n                    areValidTokens: this.areValidTokens.bind(this)\r\n                }, detail));\r\n\r\n            }\r\n\r\n        });\r\n\r\n        ARIA.Number.addMethods(/** @lends ARIA.Number.prototype */{\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            isValidToken: function (value) {\r\n\r\n                var interpretted = this.interpret(value);\r\n                var isValid = !isNotANumber(interpretted);\r\n                var attribute = this.attribute;\r\n\r\n                if (!isValid) {\r\n\r\n                    ARIA.warn(\r\n                        ARIA.supplant(ARIA.WARNING_INVALID_TOKEN, [\r\n                            value,\r\n                            attribute\r\n                        ])\r\n                    );\r\n\r\n                }\r\n\r\n                return isValid;\r\n\r\n            }\r\n\r\n        });\r\n\r\n        ARIA.State.addMethods(/** @lends ARIA.State.prototype */{\r\n\r\n            /**\r\n             * Unlike the parent {@link ARIA.Property}, an instance of\r\n             * ARIA.State always has boolean tokens added.\r\n             *\r\n             * @constructs ARIA.State\r\n             * @param      {Element} element\r\n             *             Element whose attribute should be handled.\r\n             * @param      {String} attribute\r\n             *             Name of the attribute to handle.\r\n             */\r\n            init: function (element, attribute, tokens) {\r\n                this.$super(element, attribute, BOOLEAN_TOKENS.concat(tokens));\r\n            },\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            isValidToken: function (token) {\r\n                return typeof token === \"boolean\" || this.$super(token);\r\n            }\r\n\r\n        });\r\n\r\n        ARIA.Tristate.addMethods(/** @lends ARIA.Tristate.prototype */{\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            init: function (element, attribute) {\r\n                this.$super(element, attribute, [\"mixed\"]);\r\n            }\r\n\r\n        });\r\n\r\n        ARIA.UndefinedState.addMethods(/** @lends ARIA.UndefinedState.prototype */{\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            init: function (element, attribute) {\r\n                this.$super(element, attribute, [\"undefined\"]);\r\n            },\r\n\r\n            /**\r\n             * @inheritDoc\r\n             */\r\n            isValidToken: function (token) {\r\n                return token === undefined || this.$super(token);\r\n            }\r\n\r\n        });\r\n\r\n        // Add validation.\r\n        ARIA.on(ARIA.EVENT_PRE_SET, function (e) {\r\n\r\n            var detail = e.detail;\r\n            var value = detail.value;\r\n            var isValid = (\r\n                Array.isArray(value)\r\n                ? detail.areValidTokens(value)\r\n                : detail.isValidToken(value)\r\n            );\r\n\r\n            if (!isValid) {\r\n                e.preventDefault();\r\n            }\r\n\r\n        });\r\n\r\n        // Re-make the factories.\r\n        ARIA.createFactories();\r\n\r\n    }\r\n\r\n}(window.ARIA));\r\n"],"file":"aria.tokens.js"}